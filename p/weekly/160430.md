# äº®çˆ·Weekly 0430

> é¢œå€¼è¾“ç»™å½“å¹´å°é»„ï¼ŒæŠ€æœ¯ä¸è¿‡å½“å¹´è‹±è‘£

---

[0427] cross-unzipæŠ¢æ³¨äº‹ä»¶  
https://github.com/feross/cross-zip/issues/2

> fritx: It seems that node-unzip and node-tar use pure Javascript to do the job.
I worry about their efficiency.

> feross: Hey, I literally just made a repo and was about to publish, but you beat me by one minute!  
https://github.com/feross/cross-unzip  
https://github.com/fritx/cross-unzip

> feross: @fritx If you want, we can use my version which has a parallel API to cross-zip -- i.e. it's sync, which is easier for use in build scripts, etc.

> ...

> æ˜Œçˆ·ç‚¹è¯„: æŠ¢æ³¨ç‹‚é­”

---

[0427] ç¯å¢ƒå˜é‡PATHçš„å‘  
æœ€è¿‘åšçš„å„ç§nodeé¡¹ç›® å¤šæ¬¡å’ŒPATHæ‰“äº¤é“

è¿™å›nwè‡ªåŠ¨åŒ– åšæˆelectronåº”ç”¨(ä½œæ­») æ‰“åŒ…å‰æ­£å¸¸ æ‰“åŒ…åè¿è¡Œä¸äº†  
æŸ¥äº†åŠå¤©å‘ç°åŸæ¥æ˜¯ `Error: not found: nw` which.syncæŠ¥é”™ [nw-auto:src/Nixe.js#L24](https://github.com/fritx/nw-auto/blob/39fdace09218267ebae40b25ad4e304496719071/src/Nixe.js#L24)

1. è¦ä¹ˆç”¨æˆ·å…¨å±€PATHä¸‹æœ‰nw (è¦æ±‚å¤ªé«˜)
2. è¦ä¹ˆnw-autoè‡ªå¸¦nwåœ¨depsä¸­ (nw-autoä¾èµ–å¤ªé‡)
3. è¦ä¹ˆnw-autoæ™ºèƒ½å¯»æ‰¾ç›®æ ‡åº”ç”¨æ‰€åŒ…å«çš„nw (éæ‰“åŒ…åº”ç”¨ å¯èƒ½ä¸å­˜åœ¨)
4. è¦ä¹ˆæ­¤é¡¹ç›®åŒ…å«nwåœ¨depsä¸­

æˆ‘æœ¬æ¥æ˜¯å‡å®š1.çš„ å¯è°çŸ¥macä¸‹ electronæ‰“åŒ…å PATHä»…å‰©ä¸‹å¯æ€œçš„ä¸€ç‚¹ è¿`/usr/local/bin`éƒ½æ²¡æœ‰

```plain
# electron .
/Users***REMOVED******REMOVED***auto/app/node_modules/.bin:
/usr/local/lib/node_modules/npm/bin/node-gyp-bin:/Users***REMOVED******REMOVED***auto/node_modules/.bin:/usr/local/bin:
/usr/bin:/bin:/usr/sbin:/sbin:/Users***REMOVED***/.nwjs/0.12.3

# GT_Auto.app
/usr/bin:/bin:/usr/sbin:/sbin
```

æ‰€ä»¥æˆ‘é€‰æ‹©äº†4. å†…éƒ¨å®‰è£…nw ~~å¹¶æŠŠPATHè¡¥ä¸Š~~

```js
// electronæ‰“åŒ… ä¸æŠŠ.binæ‰“è¿›å» æ‰€ä»¥å…ˆç›´æ¥åŠ nw/bin
// process.env.PATH = `${join(__dirname, '../node_modules/.bin')}${delimiter}${process.env.PATH}`
// process.env.PATH = `${join(__dirname, '../node_modules/nw/bin')}${delimiter}${process.env.PATH}`
```

è¡¥å……: ä¾ç„¶ä¼šç¢°åˆ° nodeæ‰¾ä¸åˆ° `#!/usr/local/env node`  
å› ä¸ºPATHä¸å®Œæ•´ ä¸”**ç›®æ ‡ç”¨æˆ·**å¯èƒ½å‹æ ¹æ²¡æœ‰node  
åŠ å…¥`.../nw/nwjs`åˆ°PATH?  ä¸åŒæ“ä½œç³»ç»Ÿå‘½åä¹Ÿä¸åŒ å¦‚`nw.exe`, `nwjs.app`

æ‰€ä»¥è¿˜æ˜¯å°è¯•ç›´æ¥æ”¹è¿›nw-auto å…è®¸ä¼ å…¥nwPath  
æˆ–æ˜¯è‡ªå¸¦nw.findpath() è·å–nw**å¯æ‰§è¡Œ**è·¯å¾„ => [nw-auto:src/get-nw-path.js](https://github.com/fritx/nw-auto/blob/dev/src%2Fget-nw-path.js)

---

[0426] nwä¸‹ å¼€å‘/æ‰“åŒ…ç¯å¢ƒ åˆ¤æ–­ ç±»ä¼¼[electron-is-dev](https://github.com/sindresorhus/electron-is-dev)  
win/mac å„è‡ªåˆ¤æ–­ åˆæ­¥å®šä¸º:

```js
const isNwRelease = // process.env.NODE_ENV === 'production' &&
  process.platform === 'win32' ? process.cwd() === process.execPath :
  /\/Contents\/Resources\/app\.nw$/.test(process.execPath)
```

| Windows  | Debug                | Release          |
| :------- | :------------------- | :--------------- |
| cwd      | ./debug              | ./Release        |
| execPath | ~/.nwjs/nwver/nw.exe | ./release/nw.exe |

| Mac      | Debug                                                                                 |
| :------- | :------------------------------------------------------------------------------------ |
| cwd      | ./debug                                                                               |
| execPath | ~/.nwjs/nwver/nwjs.app/Contents/Frameworks/nwjs Helper.app/Contents/MacOS/nwjs Helper |

| Mac     | Release                                                                       |
| :------ | :---------------------------------------------------------------------------- |
| cwd | ./Release.app/Contents/Resources/app.nw                                           |
| execPath | ./Release.app/Contents/Frameworks/nwjs Helper.app/Contents/MacOS/nwjs Helper |

---

[0425] å‚è€ƒäº†é’‰é’‰çš„é™é»˜æ›´æ–°æ¨¡å— å‘ç°è§£å‹zipæ—¶ ä»–ä»¬é€šè¿‡chmodæ¢å¤æ–‡ä»¶åŸæœ‰mode  
~~æˆ‘ç»å¸¸å¬ç»„é•¿è¯´ æˆ‘ä»¬æ›´æ–°æ—¶ nw.exeå®¹æ˜“å‡ºç°æƒé™é—®é¢˜ å¯èƒ½å°±æ˜¯è¿™ä¸ªåŸå› ~~

```js
// @ali/dingtalk-silent-updater/index.js
// Updater.prototype._unzip
// ...
new DecompressZip(zipfile)
  .on('error', function(err) {
    reject(err);
  }))
  .on('extract', function(log) {
    // Setup chmodSync to fix permissions
    files.forEach(function(file) {
      fs.chmodSync(path.join(destPath, file.path), file.mode);
    });
    resolve(destPath);
  })
  .extract({
    path: destPath,
    filter: function(entry) {
      files.push({
        path: entry.path,
        mode: entry.mode.toString(8)
      });
      return true;
    }
  });
```

---

[0424] github readmeä¸­ ä¸èƒ½ç›´æ¥å¼•ç”¨ repoä¸­çš„svgå›¾ç‰‡  
å¦‚ `<img src="img/prs-welcome.svg">`  
æˆ– `<img src="https://raw.githubusercontent.com/fritx/51voa-cli/img/prs-welcome.svg">`  
https://github.com/isaacs/github/issues/316  
http://stackoverflow.com/questions/13808020/include-an-svg-hosted-on-github-in-markdown

> Although you cannot link directly to SVG images from raw.github.com you could put the SVG files on the gh-pages branch and link to the files from github.io

> rawgit.com solves this problem nicely. For each request, it retrieves the appropriate document from GitHub and, crucially, serves it with the correct Content-Type header.

å‡ºäº"å®‰å…¨"åŸå›  ç›®å‰github blob/raw ä¸ä¸ºsvgæä¾›æ­£ç¡®çš„content-type  
å› æ­¤æˆ‘ä»¬ä½¿ç”¨gh-pages æˆ–æ˜¯[rawgit.com](https://rawgit.com/) æˆ–æ˜¯è‡ªå·±server

---

[0422] å¯è’™è‹±è‘£ è§£å†³ç¼–ç ä¹±ç é—®é¢˜  
https://github.com/fritx/secret/issues/13#issuecomment-215303353

> Jayin: dick..æˆ‘å‡†å¤‡çš„å†™ä¸ªcross-zip-cliï¼ˆé€ƒ
ä¸çŸ¥é“æ˜¯ä¸æ˜¯çœŸçš„è·¨å¹³å°ä»€ä¹ˆã€‚ã€‚ã€‚ã€‚åæ­£æˆ‘è§£å‹windows å‹ç¼©è¿‡çš„zipåŒ…å…¨æ˜¯ä¸­æ–‡å…¨éƒ¨å˜ä¸ºä¹±ç ğŸ˜‚ æœ‰ä»€ä¹ˆç®€å•è§£å†³åŠæ³•ï¼Ÿ

> fritx: @Jayin æ”¯æŒ ä¹±ç é—®é¢˜çš„è¯ æˆ‘ä¹‹å‰ç¢°åˆ°è¿‡ ä¸çŸ¥èƒ½å¦å¸®ä¸Šå¿™  
(from old to new)  
https://github.com/h5lium/xstu/blob/frameless/lib%2FClient.class.js#L57-L63  
https://github.com/fritx/exc/blob/dev/lib%2Ftoutf8.js  
https://github.com/fritx/buffer-encoding  
https://github.com/bmathews/node-svn-webkit/commits/master

---

[0412] ç¼–è¾‘å™¨ é€‰ä¸­å›¾ç‰‡+ç‰¹å®šæŒ‰é”® é€‰åŒºæ“ä½œ

```js
// é€€æ ¼é”® ç§»é™¤é€‰ä¸­å›¾ç‰‡ ä¿ç•™å…‰æ ‡
range.selectNode(img)
range.collapse(true)
selection.removeAllRanges()
selection.addRange(range)
img.parentNode.removeChild(img)

// æ–¹å‘é”® å–æ¶ˆé€‰ä¸­ ç§»åŠ¨å…‰æ ‡
range.selectNode(img)
range.collapse(ev.keyCode === 37 || ev.keyCode === 38)
selection.removeAllRanges()
selection.addRange(range)
img.classList.remove('selected')
```
