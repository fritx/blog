# 亮爷Weekly 0530

---

[0530] 半屏弹窗中的view切换内容时 滚动回到顶部hack

```html
<view class="event-main {{dlgEvent.show ? '' : '.refresh'}}">
```

```css
.dlg-event .event-main.refresh {
  display: none;
}
```

[0530] 微信regionpicker x 中国气象局 复杂兼容处理逻辑

```js
// 前端
let q = region[1] === region[0] || region[1] === '县' || /县级|区划|地区/.test(region[1]) ? `${region[0]} ${region[2]}` : region[1]
if (tries > maxTries / 2) {
  q = region[1] === '县' ? region[0] : region[1]
}

// 云函数
let getPlaceCode = async q => {
// ...
if (data.code === 0 && data.data.length) {
  let list = data.data.filter(v => /中国$/.test(v))
  if (list.length) return list[0].match(/^\d+/)[0]
}
let { q } = event
// 处理 '乐东黎族自治县'会查出'圣地亚哥'
// 处理 '琼中黎族苗族自治县'会查出'大足'
q = q.replace(/.族|自治县/g, '')
let code = await getPlaceCode(q)
return await getWeather(code)

// 展示简化
module.exports.simplifyRegion = function (region) {
  var list = []
  if (region[0]) list.push(region[0])
  if (region[1] && region[1] !== '重庆市' && region[1] !== '县' && region[1].indexOf('县级') < 0 && region[1].indexOf('区划') < 0) {
    list.push(region[1])
  }
  if (region[2]) list.push(region[2])
  return list.join('，')
}
```

---

[0524] 修复低版本iOS 日期详情弹窗中swiper高度无法撑开<br>
https://github.com/fritx/fritxweapp3/commit/e730e26578edc945ef52ff048889c6b7350153cc<br>

```css
.dlg-detail .weui-half-screen-dialog__bd > view {
  flex: 1;
  display: flex;
  /* flex-direction: column; */ /* 这一行是导致iOS swiper flex无法撑开的罪魁祸首 */
}
```

---

[0510] 配置 使用sshkey取代password登录ssh<br>
How To Set up SSH Keys on a Linux / Unix System<br>
https://www.cyberciti.biz/faq/how-to-set-up-ssh-keys-on-linux-unix/

```sh
# 添加 public key 到 remote
ssh-copy-id -i $HOME/.ssh/id_rsa.pub user@server1.cyberciti.biz
```

---

[0509] iphone css gradient bug<br>
linear-gradient to transparent bug in latest safari?<br>
https://stackoverflow.com/questions/38391457/linear-gradient-to-transparent-bug-in-latest-safari

```css
/* 把前后的颜色通道值统一了，就解决了 */
background-image: linear-gradient(to bottom, rgba(255,255,255,0), var(--weui-BG-1));
==>
background-image: linear-gradient(to bottom, rgba(31,31,31,0), #1f1f1f);
```

\+ hex to rgba 转换<br>
https://rgbacolorpicker.com/hex-to-rgba<br>
\+ transparent也不让用

---

[0501] 使用Docker安装Oracle步骤<br>
https://blog.csdn.net/weixin_42322206/article/details/122998716
似乎运行ok
docker volume create oracle-db<br>
docker run -d --name oracle-db -p 1521:1521 -p 8080:8080 --shm-size=1g --restart=always -e ORACLE_PWD=XXX -v oracle-db:/u01/app/oracle/oradata zerda/oracle-database:11.2.0.2-xe

[0501] 小程序坑 wx:for列表中第1个slideview按钮无法滑出<br>
原因是wx:key使用id包含0则无法滑出

```html
<!-- 注意这里wx:key如使用id包含0则导致第1个slideview按钮无法滑出 -->
<block wx:for-items="{{m1.getSelectedDay(monthDays[swiper.defaultIndex], selectedId).events}}" wx:key="title">
  <mp-slideview buttons="{{m1.getItemButtons(item, rawData.eventsByTypes, i18n)}}" bindbuttontap="handleSlideButtonTap">
```

---

[0429] 中国农历 转换 solarlunar<br>
https://www.npmjs.com/package/solarlunar

```js
import solarLunar from 'solarLunar';
const solar2lunarData = solarLunar.solar2lunar(2015, 10, 8); // 输入的日子为公历
const lunar2solarData = solarLunar.lunar2solar(2015, 8, 26); // 输入的日子为农历
>> {
  lYear: 2015,
  lMonth: 8,
  lDay: 26,
  animal: '羊',
  monthCn: '八月',
  dayCn: '廿六',
  cYear: 2015,
  cMonth: 10,
  cDay: 8,
  gzYear: '乙未',
  gzMonth: '丙戌',
  gzDay: '丁巳',
  isToday: false,
  isLeap: false,
  nWeek: 4,
  ncWeek: '星期四',
  isTerm: true,
  term: '寒露'
}
```

---

[0428] 正确理解云开发定时触发器以及开发常见问题<br>
https://developers.weixin.qq.com/community/develop/article/doc/0006a62693cfa032566ac5cd051013<br>
第三步：上传云函数、上传触发器<br>
注意：太容易漏掉 上传触发器 这一步了！！！经常调半天没效果

[0428] 开放能力 /分享到朋友圈Beta - 单页模式下的限制<br>
https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/share-timeline.html#%E5%8D%95%E9%A1%B5%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E9%99%90%E5%88%B6

[0428] 云开发，数据库自定义安全规则下，无法删除自己写的数据，请问怎么办？<br>
https://developers.weixin.qq.com/community/develop/doc/000644fd4683f034285a601915a400?_at=1595925087110<br>
指定了自定义规则，还需修改语句明确openid

---

[0427] 微信小程序中引入lodash 报错 Cannot ready property 'prototype' of undefined<br>
https://blog.csdn.net/hjiaqing/article/details/106212711

---

[0420] TenPayV3 支付出现签名错误，会是什么问题造成的。<br>
https://weixin.senparc.com/QA-3661<br>
https://developers.weixin.qq.com/miniprogram/dev/api/payment/wx.requestPayment.html
> 默认MD5，V3应该是RSA

[0420] mac 系统升级后 进入目录时 命令行报错 env: python: No such file or directory<br>
https://stackoverflow.com/questions/71468590/env-python-no-such-file-or-directory-when-building-app-with-xcode<br>
最终解法：ln -s "$(brew --prefix)/bin/python"{3,}

https://stackoverflow.com/questions/3655306/ubuntu-usr-bin-env-python-no-such-file-or-directory<br>
提到的解法：sudo ln -s /usr/bin/python3 /usr/bin/python （提示 not permitted）

[0420] 解决Parallels Desktop中文乱码问题<br>
http://www.sandbarry.com/archives/1212<br>
windows下，控制面板－区域和语言－管理－非unicode程序的语言－更改系统区域设置－简体中文

---

[0419] 微信小程序 内容安全旧接口 openapi.security.imgSecCheck 返回<br>
{"errCode":41005,"errMsg":"openapi.security.imgSecCheck:fail media data missing..."}<br>
https://developers.weixin.qq.com/community/minihome/doc/000ace88ca4500dfb66a7afe35f400<br>
临时解决方式：<br>
  "wx-server-sdk": "latest" ->>  "wx-server-sdk": "<0.4.0"<br>
长远解决方式：<br>
升级内容安全接口为新版本接口

[0419] mac系统升级后 命令行报错 ModuleNotFoundError: No module named 'thefuck'

```sh
Last login: Tue Apr 19 21:00:04 on console
Traceback (most recent call last):
  File "/usr/local/bin/thefuck", line 9, in <module>
    from thefuck.entrypoints.main import main
ModuleNotFoundError: No module named 'thefuck'
```

ImportError: No module named 'thefuck.entrypoints' #716
https://github.com/nvbn/thefuck/issues/716<br>
> Try to run sudo pip3 install -U thefuck

[0419] 新版的微信开发者工具 一保存就弹出错误码 -10007<br>
https://developers.weixin.qq.com/community/develop/doc/000c44d4020150d4f51af19f251800?_at=1594717991101

```js
// project.config.json
"setting": {
  "preloadBackgroundData": false,
```

---

[0407] 腾讯云 成功通过acme.sh 在sudo下实现免费ssl

```sh
sudo systemctl stop nginx && \
  sudo /home/ubuntu/.acme.sh/acme.sh --issue --force --standalone -d xxxxx.xxxxx.xxx && \
  sudo systemctl start nginx
```

---

[0303] scp doesn't work but ssh does (6 Solutions!!)<br>
https://superuser.com/questions/395356/scp-doesnt-work-but-ssh-does<br>
https://www.youtube.com/watch?v=BEQbea85w9w

```sh
echo -e "[ -z "$PS1" ] && return\n$(cat ~/.bashrc)" > ~/.bashrc
# or
echo -e "[[ $- == *i* ]] || return\n$(cat ~/.bashrc)" > ~/.bashrc

scp -r <user>@<host>:/<source> /<destination>  # directory
scp <user>@<host>:/<source> /<destination>  # file
```

[0303] BASH Prepend A Text / Lines To a File<br>
https://www.cyberciti.biz/faq/bash-prepend-text-lines-to-file/

```sh
echo 'line 1' > /tmp/newfile
echo 'line 2' >> /tmp/newfile
cat yourfile >> /tmp/newfile
cp /tmp/newfile yourfile

echo "text"|cat - yourfile > /tmp/out && mv /tmp/out yourfile
echo "nixCraft"|cat - yourfile > /tmp/out && mv /tmp/out yourfile

echo -e "DATA-Line-1\nDATA-Line-2\n$(cat input)" > input
cat input

sed  '1s;^;DATA-Line-1\n;' input > output
## GNU/sed syntax ##
sed -i '1s;^;DATA-Line-1\n;' input
```

---

[0301] How to create a type for complex JSON object in TypeScript?<br>
https://dev.to/ankittanna/how-to-create-a-type-for-complex-json-object-in-typescript-d81

Please provide a json basic type -- TypeScript#1897<br>
https://github.com/microsoft/TypeScript/issues/1897

Support object progress<br>
https://github.com/s-r-x/bull-monitor/issues/14<br>
https://github.com/s-r-x/bull-monitor/pull/51

```ts
type JSONValue =
    | string
    | number
    | boolean
    | { [x: string]: JSONValue }
    | Array<JSONValue>;
```
